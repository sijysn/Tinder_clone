{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yoshinoseiji/Programming/Tinder_clone/backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yoshinoseiji/Programming/Tinder_clone/backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/yoshinoseiji/Programming/Tinder_clone/backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{useSelector}from\"react-redux\";import axios from\"axios\";import Box from\"@material-ui/core/Box\";import LatestMessage from\"./LatestMessage\";import Loader from\"../Loader\";import{jsx as _jsx}from\"react/jsx-runtime\";function LatestMessages(_ref){var history=_ref.history;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),latestMessagesList=_useState2[0],setLatestMessagesList=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var config={headers:{\"content-type\":\"application/json\",Authorization:\"Bearer \".concat(userInfo.token)}};useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!userInfo){history.push(\"/login\");}case 1:case\"end\":return _context.stop();}}},_callee);})),[history,userInfo]);useEffect(function(){setLoading(true);var isMounted=true;setInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$axios$get,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!isMounted){_context2.next=7;break;}_context2.next=3;return axios.get(\"/api/messages/latest/\".concat(userInfo.id,\"/\"),config);case 3:_yield$axios$get=_context2.sent;data=_yield$axios$get.data;setLatestMessagesList(data);setLoading(false);case 7:case\"end\":return _context2.stop();}}},_callee2);})),1000);return function(){return isMounted=false;};},[]);return/*#__PURE__*/_jsx(Box,{children:loading?/*#__PURE__*/_jsx(Loader,{}):/*#__PURE__*/_jsx(Box,{children:latestMessagesList.length>0&&latestMessagesList.map(function(item){return/*#__PURE__*/_jsx(LatestMessage,{item:item},item.id);})})});}export default LatestMessages;","map":{"version":3,"sources":["/Users/yoshinoseiji/Programming/Tinder_clone/backend/frontend/src/components/MatchesScreen/LatestMessages.jsx"],"names":["React","useState","useEffect","useSelector","axios","Box","LatestMessage","Loader","LatestMessages","history","latestMessagesList","setLatestMessagesList","loading","setLoading","userLogin","state","userInfo","config","headers","Authorization","token","push","isMounted","setInterval","get","id","data","length","map","item"],"mappings":"yhBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,OAASC,WAAT,KAA4B,aAA5B,CAEA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CAEA,MAAOC,CAAAA,GAAP,KAAgB,uBAAhB,CAEA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,CACA,MAAOC,CAAAA,MAAP,KAAmB,WAAnB,C,2CAEA,QAASC,CAAAA,cAAT,MAAqC,IAAXC,CAAAA,OAAW,MAAXA,OAAW,eACiBR,QAAQ,CAAC,EAAD,CADzB,wCAC5BS,kBAD4B,eACRC,qBADQ,8BAELV,QAAQ,CAAC,KAAD,CAFH,yCAE5BW,OAF4B,eAEnBC,UAFmB,eAInC,GAAMC,CAAAA,SAAS,CAAGX,WAAW,CAAC,SAACY,KAAD,QAAWA,CAAAA,KAAK,CAACD,SAAjB,EAAD,CAA7B,CAJmC,GAK3BE,CAAAA,QAL2B,CAKdF,SALc,CAK3BE,QAL2B,CAOnC,GAAMC,CAAAA,MAAM,CAAG,CACbC,OAAO,CAAE,CACP,eAAgB,kBADT,CAEPC,aAAa,kBAAYH,QAAQ,CAACI,KAArB,CAFN,CADI,CAAf,CAOAlB,SAAS,sEAAC,mIACR,GAAI,CAACc,QAAL,CAAe,CACbP,OAAO,CAACY,IAAR,CAAa,QAAb,EACD,CAHO,sDAAD,GAIN,CAACZ,OAAD,CAAUO,QAAV,CAJM,CAAT,CAMAd,SAAS,CAAC,UAAM,CACdW,UAAU,CAAC,IAAD,CAAV,CAEA,GAAIS,CAAAA,SAAS,CAAG,IAAhB,CAEAC,WAAW,sEAAC,sKACND,SADM,iDAEelB,CAAAA,KAAK,CAACoB,GAAN,gCACGR,QAAQ,CAACS,EADZ,MAErBR,MAFqB,CAFf,wCAEAS,IAFA,kBAEAA,IAFA,CAORf,qBAAqB,CAACe,IAAD,CAArB,CACAb,UAAU,CAAC,KAAD,CAAV,CARQ,wDAAD,GAUR,IAVQ,CAAX,CAYA,MAAO,kBAAOS,CAAAA,SAAS,CAAG,KAAnB,EAAP,CACD,CAlBQ,CAkBN,EAlBM,CAAT,CAoBA,mBACE,KAAC,GAAD,WACGV,OAAO,cACN,KAAC,MAAD,IADM,cAGN,KAAC,GAAD,WACGF,kBAAkB,CAACiB,MAAnB,CAA4B,CAA5B,EACCjB,kBAAkB,CAACkB,GAAnB,CAAuB,SAACC,IAAD,qBACrB,KAAC,aAAD,EAAe,IAAI,CAAEA,IAArB,EAAgCA,IAAI,CAACJ,EAArC,CADqB,EAAvB,CAFJ,EAJJ,EADF,CAcD,CAED,cAAejB,CAAAA,cAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useSelector } from \"react-redux\";\n\nimport axios from \"axios\";\n\nimport Box from \"@material-ui/core/Box\";\n\nimport LatestMessage from \"./LatestMessage\";\nimport Loader from \"../Loader\";\n\nfunction LatestMessages({ history }) {\n  const [latestMessagesList, setLatestMessagesList] = useState([]);\n  const [loading, setLoading] = useState(false);\n\n  const userLogin = useSelector((state) => state.userLogin);\n  const { userInfo } = userLogin;\n\n  const config = {\n    headers: {\n      \"content-type\": \"application/json\",\n      Authorization: `Bearer ${userInfo.token}`,\n    },\n  };\n\n  useEffect(async () => {\n    if (!userInfo) {\n      history.push(\"/login\");\n    }\n  }, [history, userInfo]);\n\n  useEffect(() => {\n    setLoading(true);\n\n    let isMounted = true;\n\n    setInterval(async () => {\n      if (isMounted) {\n        const { data } = await axios.get(\n          `/api/messages/latest/${userInfo.id}/`,\n          config\n        );\n\n        setLatestMessagesList(data);\n        setLoading(false);\n      }\n    }, 1000);\n\n    return () => (isMounted = false);\n  }, []);\n\n  return (\n    <Box>\n      {loading ? (\n        <Loader />\n      ) : (\n        <Box>\n          {latestMessagesList.length > 0 &&\n            latestMessagesList.map((item) => (\n              <LatestMessage item={item} key={item.id} />\n            ))}\n        </Box>\n      )}\n    </Box>\n  );\n}\n\nexport default LatestMessages;\n"]},"metadata":{},"sourceType":"module"}