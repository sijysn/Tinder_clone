{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yoshinoseiji/Programming/Tinder_clone/backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yoshinoseiji/Programming/Tinder_clone/backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/yoshinoseiji/Programming/Tinder_clone/backend/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useCallback}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import axios from\"axios\";import ArrowDownwardIcon from\"@material-ui/icons/ArrowDownward\";import InfoIcon from\"@material-ui/icons/Info\";import IconButton from\"@material-ui/core/IconButton\";import Box from\"@material-ui/core/Box\";import Typography from\"@material-ui/core/Typography\";import Grid from\"@material-ui/core/Grid\";import Card from\"@material-ui/core/Card\";import CardActionArea from\"@material-ui/core/CardActionArea\";import CardContent from\"@material-ui/core/CardContent\";import CardMedia from\"@material-ui/core/CardMedia\";import{useStyles}from\"../../styles\";import calcAge from\"../../functions/calcAge\";import createChatRoom from\"../../functions/createChatRoom\";import{onBlock,offBlock}from\"../../actions/blockActions\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SwipeableCard=function SwipeableCard(_ref){var person=_ref.person,className=_ref.className,cardIsEmpty=_ref.cardIsEmpty;var classes=useStyles();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),selfIntroIsDisplayed=_useState2[0],setSelfIntroIsDisplayed=_useState2[1];var age=person.birth_date?calcAge(person.birth_date):\"-\";var isBlocked=useSelector(function(state){return state.isBlocked;});var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var dispatch=useDispatch();var config={headers:{\"content-type\":\"application/json\",Authorization:\"Bearer \".concat(userInfo.token)}};var readMore=function readMore(){if(isBlocked)return;if(!selfIntroIsDisplayed){setSelfIntroIsDisplayed(true);dispatch(onBlock());}};var readLess=function readLess(e){if(isBlocked)return;if(selfIntroIsDisplayed){setSelfIntroIsDisplayed(false);e.stopPropagation();}};var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),swipedUser=_useState4[0],setSwipedUser=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),nextUser=_useState6[0],setNextUser=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),like=_useState8[0],setLike=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),nope=_useState10[0],setNope=_useState10[1];var startX;var startY;var moveX;var moveY;var distanceX;var distanceY;var mdown=useCallback(function(e){dispatch(onBlock());// Add class \"drag\" to card\nswipedUser.classList.add(\"drag\");// Normalize mouse and touch\nif(e.type===\"mousedown\"){var event=e;}else{var event=e.changedTouches[0];}// Get location where card starts to move\nstartX=event.pageX;startY=event.pageY;// Occur when card moves\ndocument.body.addEventListener(\"mousemove\",mmove,false);document.body.addEventListener(\"touchmove\",mmove,false);},[dispatch,swipedUser]);var mmove=useCallback(function(e){// Normalize mouse and touch\nif(e.type===\"mousemove\"){var event=e;}else{var event=e.changedTouches[0];}// Move card to where mouse is\nmoveY=event.pageY;moveX=event.pageX;distanceX=moveX-startX;distanceY=moveY-startY;swipedUser.style.top=distanceY+\"px\";swipedUser.style.left=distanceX+\"px\";// Rotate card as distanceX gets longer\nvar rotate=distanceX/10;swipedUser.style.transform=\"rotate(\".concat(rotate,\"deg)\");// Display card more clearly as distanceX gets longer\nif(distanceX>=0){like.style.opacity=distanceX/100;}else{nope.style.opacity=-distanceX/100;}// Occur when mouse or touch is left\nswipedUser.addEventListener(\"mouseup\",mup,false);document.body.addEventListener(\"mouseleave\",mup,false);swipedUser.addEventListener(\"touchend\",mup,false);document.body.addEventListener(\"touchleave\",mup,false);},[swipedUser,like,nope]);var mup=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var likeOrNope;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(Math.abs(distanceX)<75&&Math.abs(distanceY)<75)){_context.next=9;break;}swipedUser.style.left=0;swipedUser.style.top=0;swipedUser.style.transform=\"rotate(0)\";like.style.opacity=0;nope.style.opacity=0;dispatch(offBlock());_context.next=20;break;case 9:// Mark card as \"like\" or \"nope\" based on distance\nif(distanceX>=75){swipedUser.style.left=\"150%\";likeOrNope=\"like\";}else if(distanceX<=-75){swipedUser.style.left=\"-150%\";likeOrNope=\"nope\";}else if(distanceX>0&&Math.abs(distanceY)>=75){swipedUser.style.left=\"150%\";likeOrNope=\"like\";}else if(distanceX<0&&Math.abs(distanceY)>=75){swipedUser.style.left=\"-150%\";likeOrNope=\"nope\";}// Delete event listers\ndocument.body.removeEventListener(\"mousemove\",mmove,false);swipedUser.removeEventListener(\"mouseup\",mup,false);document.body.removeEventListener(\"touchmove\",mmove,false);swipedUser.removeEventListener(\"touchend\",mup,false);// Delete class \"drag\"\nswipedUser.classList.remove(\"drag\");// Delete swiped card\nsetTimeout(function(){return swipedUser.remove();},200);// React by Like or Nope\n_context.next=18;return axios.post(\"/api/reactions/swipe/\",{fromUserId:userInfo.id,toUserId:Number(swipedUser.id),status:likeOrNope===\"like\"?\"L\":\"N\"},config);case 18:// If match, create chat room and register chat room users\nif(likeOrNope===\"like\"){createChatRoom(userInfo.id,swipedUser.id,config);}// If all Cards have been swiped, show Empty component\nif(nextUser===null){setTimeout(function(){return cardIsEmpty();},200);dispatch(onBlock());}else{setTimeout(function(){return dispatch(offBlock());},500);}case 20:case\"end\":return _context.stop();}}},_callee);})),[dispatch,swipedUser]);useEffect(function(){setSwipedUser(document.getElementById(person.id));setNextUser(document.getElementById(person.id).nextElementSibling);setLike(document.getElementById(person.id).firstChild.nextElementSibling);setNope(document.getElementById(person.id).firstChild.nextElementSibling.nextElementSibling);},[]);useEffect(function(){if(!swipedUser)return;// When self introduction is displayed, not allow user to swipe\nif(selfIntroIsDisplayed){document.body.removeEventListener(\"mousemove\",mmove,false);document.body.removeEventListener(\"touchmove\",mmove,false);document.body.removeEventListener(\"mouseleave\",mup,false);document.body.removeEventListener(\"touchleave\",mup,false);}// When blocked, delete event\nif(isBlocked){swipedUser.removeEventListener(\"mousedown\",mdown,false);swipedUser.removeEventListener(\"touchstart\",mdown,false);}// When not blocked and self introduction is not displayed, allow user to swipe\nif(!isBlocked&&!selfIntroIsDisplayed){swipedUser.addEventListener(\"mousedown\",mdown,false);swipedUser.addEventListener(\"touchstart\",mdown,false);}},[swipedUser,isBlocked,selfIntroIsDisplayed,mdown,mmove,mdown]);return/*#__PURE__*/_jsxs(Card,{className:className,id:person.id,children:[/*#__PURE__*/_jsx(CardMedia,{image:person.image?person.image:\"/images/unknown.png\",className:classes.cardImage,title:\"profile photo\"}),/*#__PURE__*/_jsx(Typography,{component:\"span\",variant:\"h3\",className:\"card__like\",children:\"LIKE\"}),/*#__PURE__*/_jsx(Typography,{component:\"span\",variant:\"h3\",className:\"card__nope\",children:\"NOPE\"}),/*#__PURE__*/_jsx(CardActionArea,{onClick:readMore,children:/*#__PURE__*/_jsxs(CardContent,{className:classes.cardContent,children:[/*#__PURE__*/_jsxs(Typography,{component:\"h1\",variant:\"h3\",gutterBottom:true,children:[/*#__PURE__*/_jsx(\"strong\",{children:person.first_name}),\" \",/*#__PURE__*/_jsx(Typography,{component:\"span\",variant:\"h4\",children:age})]}),/*#__PURE__*/_jsxs(Grid,{container:true,alignItems:\"center\",children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:6,children:person.profession&&/*#__PURE__*/_jsxs(Typography,{component:\"h2\",variant:\"h6\",gutterBottom:true,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-graduation-cap\"}),\" \",person.profession]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:6,children:/*#__PURE__*/_jsx(Box,{component:\"div\",textAlign:\"right\",children:selfIntroIsDisplayed?/*#__PURE__*/_jsx(IconButton,{style:{backgroundColor:\"#f50057\"},component:\"span\",onClick:function onClick(e){return readLess(e);},children:/*#__PURE__*/_jsx(ArrowDownwardIcon,{style:{color:\"#fff\"},fontSize:\"large\"})}):/*#__PURE__*/_jsx(IconButton,{component:\"span\",children:/*#__PURE__*/_jsx(InfoIcon,{fontSize:\"large\"})})})})]}),selfIntroIsDisplayed&&/*#__PURE__*/_jsx(Box,{mt:1,children:/*#__PURE__*/_jsx(Typography,{component:\"p\",variant:\"h5\",color:\"textSecondary\",className:classes.cardDetail,children:person.self_introduction})})]})})]});};export default SwipeableCard;","map":{"version":3,"sources":["/Users/yoshinoseiji/Programming/Tinder_clone/backend/frontend/src/components/RecsScreen/SwipeableCard.jsx"],"names":["React","useState","useEffect","useCallback","useSelector","useDispatch","axios","ArrowDownwardIcon","InfoIcon","IconButton","Box","Typography","Grid","Card","CardActionArea","CardContent","CardMedia","useStyles","calcAge","createChatRoom","onBlock","offBlock","SwipeableCard","person","className","cardIsEmpty","classes","selfIntroIsDisplayed","setSelfIntroIsDisplayed","age","birth_date","isBlocked","state","userLogin","userInfo","dispatch","config","headers","Authorization","token","readMore","readLess","e","stopPropagation","swipedUser","setSwipedUser","nextUser","setNextUser","like","setLike","nope","setNope","startX","startY","moveX","moveY","distanceX","distanceY","mdown","classList","add","type","event","changedTouches","pageX","pageY","document","body","addEventListener","mmove","style","top","left","rotate","transform","opacity","mup","Math","abs","likeOrNope","removeEventListener","remove","setTimeout","post","fromUserId","id","toUserId","Number","status","getElementById","nextElementSibling","firstChild","image","cardImage","cardContent","first_name","profession","backgroundColor","color","cardDetail","self_introduction"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\n\nimport axios from \"axios\";\n\nimport ArrowDownwardIcon from \"@material-ui/icons/ArrowDownward\";\nimport InfoIcon from \"@material-ui/icons/Info\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Box from \"@material-ui/core/Box\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Card from \"@material-ui/core/Card\";\nimport CardActionArea from \"@material-ui/core/CardActionArea\";\nimport CardContent from \"@material-ui/core/CardContent\";\nimport CardMedia from \"@material-ui/core/CardMedia\";\n\nimport { useStyles } from \"../../styles\";\n\nimport calcAge from \"../../functions/calcAge\";\nimport createChatRoom from \"../../functions/createChatRoom\";\n\nimport { onBlock, offBlock } from \"../../actions/blockActions\";\n\nconst SwipeableCard = ({ person, className, cardIsEmpty }) => {\n  const classes = useStyles();\n\n  const [selfIntroIsDisplayed, setSelfIntroIsDisplayed] = useState(false);\n\n  const age = person.birth_date ? calcAge(person.birth_date) : \"-\";\n\n  const isBlocked = useSelector((state) => state.isBlocked);\n  const userLogin = useSelector((state) => state.userLogin);\n  const { userInfo } = userLogin;\n\n  const dispatch = useDispatch();\n\n  const config = {\n    headers: {\n      \"content-type\": \"application/json\",\n      Authorization: `Bearer ${userInfo.token}`,\n    },\n  };\n\n  const readMore = () => {\n    if (isBlocked) return;\n\n    if (!selfIntroIsDisplayed) {\n      setSelfIntroIsDisplayed(true);\n      dispatch(onBlock());\n    }\n  };\n\n  const readLess = (e) => {\n    if (isBlocked) return;\n\n    if (selfIntroIsDisplayed) {\n      setSelfIntroIsDisplayed(false);\n      e.stopPropagation();\n    }\n  };\n\n  const [swipedUser, setSwipedUser] = useState();\n  const [nextUser, setNextUser] = useState();\n  const [like, setLike] = useState();\n  const [nope, setNope] = useState();\n\n  var startX;\n  var startY;\n  var moveX;\n  var moveY;\n  var distanceX;\n  var distanceY;\n\n  const mdown = useCallback(\n    (e) => {\n      dispatch(onBlock());\n\n      // Add class \"drag\" to card\n      swipedUser.classList.add(\"drag\");\n\n      // Normalize mouse and touch\n      if (e.type === \"mousedown\") {\n        var event = e;\n      } else {\n        var event = e.changedTouches[0];\n      }\n\n      // Get location where card starts to move\n      startX = event.pageX;\n      startY = event.pageY;\n\n      // Occur when card moves\n      document.body.addEventListener(\"mousemove\", mmove, false);\n      document.body.addEventListener(\"touchmove\", mmove, false);\n    },\n    [dispatch, swipedUser]\n  );\n\n  const mmove = useCallback(\n    (e) => {\n      // Normalize mouse and touch\n      if (e.type === \"mousemove\") {\n        var event = e;\n      } else {\n        var event = e.changedTouches[0];\n      }\n\n      // Move card to where mouse is\n      moveY = event.pageY;\n      moveX = event.pageX;\n\n      distanceX = moveX - startX;\n      distanceY = moveY - startY;\n\n      swipedUser.style.top = distanceY + \"px\";\n      swipedUser.style.left = distanceX + \"px\";\n\n      // Rotate card as distanceX gets longer\n      const rotate = distanceX / 10;\n      swipedUser.style.transform = `rotate(${rotate}deg)`;\n\n      // Display card more clearly as distanceX gets longer\n      if (distanceX >= 0) {\n        like.style.opacity = distanceX / 100;\n      } else {\n        nope.style.opacity = -distanceX / 100;\n      }\n\n      // Occur when mouse or touch is left\n      swipedUser.addEventListener(\"mouseup\", mup, false);\n      document.body.addEventListener(\"mouseleave\", mup, false);\n      swipedUser.addEventListener(\"touchend\", mup, false);\n      document.body.addEventListener(\"touchleave\", mup, false);\n    },\n    [swipedUser, like, nope]\n  );\n\n  const mup = useCallback(async () => {\n    if (Math.abs(distanceX) < 75 && Math.abs(distanceY) < 75) {\n      swipedUser.style.left = 0;\n      swipedUser.style.top = 0;\n      swipedUser.style.transform = \"rotate(0)\";\n      like.style.opacity = 0;\n      nope.style.opacity = 0;\n\n      dispatch(offBlock());\n    } else {\n      // Mark card as \"like\" or \"nope\" based on distance\n      let likeOrNope;\n      if (distanceX >= 75) {\n        swipedUser.style.left = \"150%\";\n        likeOrNope = \"like\";\n      } else if (distanceX <= -75) {\n        swipedUser.style.left = \"-150%\";\n        likeOrNope = \"nope\";\n      } else if (distanceX > 0 && Math.abs(distanceY) >= 75) {\n        swipedUser.style.left = \"150%\";\n        likeOrNope = \"like\";\n      } else if (distanceX < 0 && Math.abs(distanceY) >= 75) {\n        swipedUser.style.left = \"-150%\";\n        likeOrNope = \"nope\";\n      }\n\n      // Delete event listers\n\n      document.body.removeEventListener(\"mousemove\", mmove, false);\n      swipedUser.removeEventListener(\"mouseup\", mup, false);\n      document.body.removeEventListener(\"touchmove\", mmove, false);\n      swipedUser.removeEventListener(\"touchend\", mup, false);\n\n      // Delete class \"drag\"\n      swipedUser.classList.remove(\"drag\");\n\n      // Delete swiped card\n      setTimeout(() => swipedUser.remove(), 200);\n\n      // React by Like or Nope\n      await axios.post(\n        \"/api/reactions/swipe/\",\n        {\n          fromUserId: userInfo.id,\n          toUserId: Number(swipedUser.id),\n          status: likeOrNope === \"like\" ? \"L\" : \"N\",\n        },\n        config\n      );\n\n      // If match, create chat room and register chat room users\n      if (likeOrNope === \"like\") {\n        createChatRoom(userInfo.id, swipedUser.id, config);\n      }\n\n      // If all Cards have been swiped, show Empty component\n      if (nextUser === null) {\n        setTimeout(() => cardIsEmpty(), 200);\n        dispatch(onBlock());\n      } else {\n        setTimeout(() => dispatch(offBlock()), 500);\n      }\n    }\n  }, [dispatch, swipedUser]);\n\n  useEffect(() => {\n    setSwipedUser(document.getElementById(person.id));\n    setNextUser(document.getElementById(person.id).nextElementSibling);\n    setLike(document.getElementById(person.id).firstChild.nextElementSibling);\n    setNope(\n      document.getElementById(person.id).firstChild.nextElementSibling\n        .nextElementSibling\n    );\n  }, []);\n\n  useEffect(() => {\n    if (!swipedUser) return;\n\n    // When self introduction is displayed, not allow user to swipe\n    if (selfIntroIsDisplayed) {\n      document.body.removeEventListener(\"mousemove\", mmove, false);\n      document.body.removeEventListener(\"touchmove\", mmove, false);\n      document.body.removeEventListener(\"mouseleave\", mup, false);\n      document.body.removeEventListener(\"touchleave\", mup, false);\n    }\n\n    // When blocked, delete event\n    if (isBlocked) {\n      swipedUser.removeEventListener(\"mousedown\", mdown, false);\n      swipedUser.removeEventListener(\"touchstart\", mdown, false);\n    }\n\n    // When not blocked and self introduction is not displayed, allow user to swipe\n    if (!isBlocked && !selfIntroIsDisplayed) {\n      swipedUser.addEventListener(\"mousedown\", mdown, false);\n      swipedUser.addEventListener(\"touchstart\", mdown, false);\n    }\n  }, [swipedUser, isBlocked, selfIntroIsDisplayed, mdown, mmove, mdown]);\n\n  return (\n    <Card className={className} id={person.id}>\n      <CardMedia\n        image={person.image ? person.image : \"/images/unknown.png\"}\n        className={classes.cardImage}\n        title=\"profile photo\"\n      />\n      <Typography component=\"span\" variant=\"h3\" className=\"card__like\">\n        LIKE\n      </Typography>\n      <Typography component=\"span\" variant=\"h3\" className=\"card__nope\">\n        NOPE\n      </Typography>\n\n      <CardActionArea onClick={readMore}>\n        <CardContent className={classes.cardContent}>\n          <Typography component=\"h1\" variant=\"h3\" gutterBottom>\n            <strong>{person.first_name}</strong>{\" \"}\n            <Typography component=\"span\" variant=\"h4\">\n              {age}\n            </Typography>\n          </Typography>\n\n          <Grid container alignItems=\"center\">\n            <Grid item xs={6}>\n              {person.profession && (\n                <Typography component=\"h2\" variant=\"h6\" gutterBottom>\n                  <i className=\"fas fa-graduation-cap\"></i> {person.profession}\n                </Typography>\n              )}\n            </Grid>\n\n            <Grid item xs={6}>\n              <Box component=\"div\" textAlign=\"right\">\n                {selfIntroIsDisplayed ? (\n                  <IconButton\n                    style={{\n                      backgroundColor: \"#f50057\",\n                    }}\n                    component=\"span\"\n                    onClick={(e) => readLess(e)}\n                  >\n                    <ArrowDownwardIcon\n                      style={{\n                        color: \"#fff\",\n                      }}\n                      fontSize=\"large\"\n                    />\n                  </IconButton>\n                ) : (\n                  <IconButton component=\"span\">\n                    <InfoIcon fontSize=\"large\" />\n                  </IconButton>\n                )}\n              </Box>\n            </Grid>\n          </Grid>\n\n          {selfIntroIsDisplayed && (\n            <Box mt={1}>\n              <Typography\n                component=\"p\"\n                variant=\"h5\"\n                color=\"textSecondary\"\n                className={classes.cardDetail}\n              >\n                {person.self_introduction}\n              </Typography>\n            </Box>\n          )}\n        </CardContent>\n      </CardActionArea>\n    </Card>\n  );\n};\n\nexport default SwipeableCard;\n"]},"metadata":{},"sourceType":"module"}