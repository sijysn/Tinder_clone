{"ast":null,"code":"var _jsxFileName = \"/Users/yoshinoseiji/Programming/Tinder_clone/backend/frontend/src/components/RecsScreen/SwipeableCard.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport axios from \"axios\";\nimport ArrowDownwardIcon from \"@material-ui/icons/ArrowDownward\";\nimport InfoIcon from \"@material-ui/icons/Info\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Box from \"@material-ui/core/Box\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Card from \"@material-ui/core/Card\";\nimport CardActionArea from \"@material-ui/core/CardActionArea\";\nimport CardContent from \"@material-ui/core/CardContent\";\nimport CardMedia from \"@material-ui/core/CardMedia\";\nimport { useStyles } from \"../../styles\";\nimport calcAge from \"../../functions/calcAge\";\nimport createChatRoom from \"../../functions/createChatRoom\";\nimport { onBlock, offBlock } from \"../../actions/blockActions\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst SwipeableCard = ({\n  person,\n  className,\n  cardIsEmpty\n}) => {\n  _s();\n\n  const classes = useStyles();\n  const [selfIntroIsDisplayed, setSelfIntroIsDisplayed] = useState(false);\n  const age = person.birth_date ? calcAge(person.birth_date) : \"-\";\n  const isBlocked = useSelector(state => state.isBlocked);\n  const userLogin = useSelector(state => state.userLogin);\n  const {\n    userInfo\n  } = userLogin;\n  const dispatch = useDispatch();\n  const config = {\n    headers: {\n      \"content-type\": \"application/json\",\n      Authorization: `Bearer ${userInfo.token}`\n    }\n  };\n\n  const readMore = () => {\n    if (isBlocked) return;\n\n    if (!selfIntroIsDisplayed) {\n      setSelfIntroIsDisplayed(true);\n      dispatch(onBlock());\n    }\n  };\n\n  const readLess = e => {\n    if (isBlocked) return;\n\n    if (selfIntroIsDisplayed) {\n      setSelfIntroIsDisplayed(false);\n      e.stopPropagation();\n    }\n  };\n\n  const [swipedUser, setSwipedUser] = useState();\n  const [nextUser, setNextUser] = useState();\n  const [like, setLike] = useState();\n  const [nope, setNope] = useState();\n  var startX;\n  var startY;\n  var moveX;\n  var moveY;\n  var distanceX;\n  var distanceY;\n  const mdown = useCallback(e => {\n    dispatch(onBlock()); // Add class \"drag\" to card\n\n    swipedUser.classList.add(\"drag\"); // Normalize mouse and touch\n\n    if (e.type === \"mousedown\") {\n      var event = e;\n    } else {\n      var event = e.changedTouches[0];\n    } // Get location where card starts to move\n\n\n    startX = event.pageX;\n    startY = event.pageY; // Occur when card moves\n\n    document.body.addEventListener(\"mousemove\", mmove, false);\n    document.body.addEventListener(\"touchmove\", mmove, false);\n  }, [dispatch, swipedUser]);\n  const mmove = useCallback(e => {\n    // Normalize mouse and touch\n    if (e.type === \"mousemove\") {\n      var event = e;\n    } else {\n      var event = e.changedTouches[0];\n    } // Move card to where mouse is\n\n\n    moveY = event.pageY;\n    moveX = event.pageX;\n    distanceX = moveX - startX;\n    distanceY = moveY - startY;\n    swipedUser.style.top = distanceY + \"px\";\n    swipedUser.style.left = distanceX + \"px\"; // Rotate card as distanceX gets longer\n\n    const rotate = distanceX / 10;\n    swipedUser.style.transform = `rotate(${rotate}deg)`; // Display card more clearly as distanceX gets longer\n\n    if (distanceX >= 0) {\n      like.style.opacity = distanceX / 100;\n    } else {\n      nope.style.opacity = -distanceX / 100;\n    } // Occur when mouse or touch is left\n\n\n    swipedUser.addEventListener(\"mouseup\", mup, false);\n    document.body.addEventListener(\"mouseleave\", mup, false);\n    swipedUser.addEventListener(\"touchend\", mup, false);\n    document.body.addEventListener(\"touchleave\", mup, false);\n  }, [swipedUser, like, nope]);\n  const mup = useCallback(async () => {\n    if (Math.abs(distanceX) < 75 && Math.abs(distanceY) < 75) {\n      swipedUser.style.left = 0;\n      swipedUser.style.top = 0;\n      swipedUser.style.transform = \"rotate(0)\";\n      like.style.opacity = 0;\n      nope.style.opacity = 0;\n      dispatch(offBlock());\n    } else {\n      // Mark card as \"like\" or \"nope\" based on distance\n      let likeOrNope;\n\n      if (distanceX >= 75) {\n        swipedUser.style.left = \"150%\";\n        likeOrNope = \"like\";\n      } else if (distanceX <= -75) {\n        swipedUser.style.left = \"-150%\";\n        likeOrNope = \"nope\";\n      } else if (distanceX > 0 && Math.abs(distanceY) >= 75) {\n        swipedUser.style.left = \"150%\";\n        likeOrNope = \"like\";\n      } else if (distanceX < 0 && Math.abs(distanceY) >= 75) {\n        swipedUser.style.left = \"-150%\";\n        likeOrNope = \"nope\";\n      } // Delete event listers\n\n\n      document.body.removeEventListener(\"mousemove\", mmove, false);\n      swipedUser.removeEventListener(\"mouseup\", mup, false);\n      document.body.removeEventListener(\"touchmove\", mmove, false);\n      swipedUser.removeEventListener(\"touchend\", mup, false); // Delete class \"drag\"\n\n      swipedUser.classList.remove(\"drag\"); // Delete swiped card\n\n      setTimeout(() => swipedUser.remove(), 200); // React by Like or Nope\n\n      await axios.post(\"/api/reactions/swipe/\", {\n        fromUserId: userInfo.id,\n        toUserId: Number(swipedUser.id),\n        status: likeOrNope === \"like\" ? \"L\" : \"N\"\n      }, config); // If match, create chat room and register chat room users\n\n      if (likeOrNope === \"like\") {\n        createChatRoom(userInfo.id, swipedUser.id, config);\n      } // If all Cards have been swiped, show Empty component\n\n\n      if (nextUser === null) {\n        setTimeout(() => cardIsEmpty(), 200);\n        dispatch(onBlock());\n      } else {\n        setTimeout(() => dispatch(offBlock()), 500);\n      }\n    }\n  }, [dispatch, swipedUser]);\n  useEffect(() => {\n    setSwipedUser(document.getElementById(person.id));\n    setNextUser(document.getElementById(person.id).nextElementSibling);\n    setLike(document.getElementById(person.id).firstChild.nextElementSibling);\n    setNope(document.getElementById(person.id).firstChild.nextElementSibling.nextElementSibling);\n  }, []);\n  useEffect(() => {\n    if (!swipedUser) return; // When self introduction is displayed, not allow user to swipe\n\n    if (selfIntroIsDisplayed) {\n      document.body.removeEventListener(\"mousemove\", mmove, false);\n      document.body.removeEventListener(\"touchmove\", mmove, false);\n      document.body.removeEventListener(\"mouseleave\", mup, false);\n      document.body.removeEventListener(\"touchleave\", mup, false);\n    } // When blocked, delete event\n\n\n    if (isBlocked) {\n      swipedUser.removeEventListener(\"mousedown\", mdown, false);\n      swipedUser.removeEventListener(\"touchstart\", mdown, false);\n    } // When not blocked and self introduction is not displayed, allow user to swipe\n\n\n    if (!isBlocked && !selfIntroIsDisplayed) {\n      swipedUser.addEventListener(\"mousedown\", mdown, false);\n      swipedUser.addEventListener(\"touchstart\", mdown, false);\n    }\n  }, [swipedUser, isBlocked, selfIntroIsDisplayed, mdown, mmove, mdown]);\n  return /*#__PURE__*/_jsxDEV(Card, {\n    className: className,\n    id: person.id,\n    children: [/*#__PURE__*/_jsxDEV(CardMedia, {\n      image: person.image ? person.image : \"/images/unknown.png\",\n      className: classes.cardImage,\n      title: \"profile photo\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Typography, {\n      component: \"span\",\n      variant: \"h3\",\n      className: \"card__like\",\n      children: \"LIKE\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Typography, {\n      component: \"span\",\n      variant: \"h3\",\n      className: \"card__nope\",\n      children: \"NOPE\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(CardActionArea, {\n      onClick: readMore,\n      children: /*#__PURE__*/_jsxDEV(CardContent, {\n        className: classes.cardContent,\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          component: \"h1\",\n          variant: \"h3\",\n          gutterBottom: true,\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: person.first_name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 254,\n            columnNumber: 13\n          }, this), \" \", /*#__PURE__*/_jsxDEV(Typography, {\n            component: \"span\",\n            variant: \"h4\",\n            children: age\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 255,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          alignItems: \"center\",\n          children: [/*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 6,\n            children: person.profession && /*#__PURE__*/_jsxDEV(Typography, {\n              component: \"h2\",\n              variant: \"h6\",\n              gutterBottom: true,\n              children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"fas fa-graduation-cap\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 264,\n                columnNumber: 19\n              }, this), \" \", person.profession]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 263,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 261,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 6,\n            children: /*#__PURE__*/_jsxDEV(Box, {\n              component: \"div\",\n              textAlign: \"right\",\n              children: selfIntroIsDisplayed ? /*#__PURE__*/_jsxDEV(IconButton, {\n                style: {\n                  backgroundColor: \"#f50057\"\n                },\n                component: \"span\",\n                onClick: e => readLess(e),\n                children: /*#__PURE__*/_jsxDEV(ArrowDownwardIcon, {\n                  style: {\n                    color: \"#fff\"\n                  },\n                  fontSize: \"large\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 279,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 272,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(IconButton, {\n                component: \"span\",\n                children: /*#__PURE__*/_jsxDEV(InfoIcon, {\n                  fontSize: \"large\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 288,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 287,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 270,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 260,\n          columnNumber: 11\n        }, this), selfIntroIsDisplayed && /*#__PURE__*/_jsxDEV(Box, {\n          mt: 1,\n          children: /*#__PURE__*/_jsxDEV(Typography, {\n            component: \"p\",\n            variant: \"h5\",\n            color: \"textSecondary\",\n            className: classes.cardDetail,\n            children: person.self_introduction\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 238,\n    columnNumber: 5\n  }, this);\n};\n\n_s(SwipeableCard, \"fgGm705M8VR5gxOHcb6Wsm/CrRQ=\", false, function () {\n  return [useStyles, useSelector, useSelector, useDispatch];\n});\n\n_c = SwipeableCard;\nexport default SwipeableCard;\n\nvar _c;\n\n$RefreshReg$(_c, \"SwipeableCard\");","map":{"version":3,"sources":["/Users/yoshinoseiji/Programming/Tinder_clone/backend/frontend/src/components/RecsScreen/SwipeableCard.jsx"],"names":["React","useState","useEffect","useCallback","useSelector","useDispatch","axios","ArrowDownwardIcon","InfoIcon","IconButton","Box","Typography","Grid","Card","CardActionArea","CardContent","CardMedia","useStyles","calcAge","createChatRoom","onBlock","offBlock","SwipeableCard","person","className","cardIsEmpty","classes","selfIntroIsDisplayed","setSelfIntroIsDisplayed","age","birth_date","isBlocked","state","userLogin","userInfo","dispatch","config","headers","Authorization","token","readMore","readLess","e","stopPropagation","swipedUser","setSwipedUser","nextUser","setNextUser","like","setLike","nope","setNope","startX","startY","moveX","moveY","distanceX","distanceY","mdown","classList","add","type","event","changedTouches","pageX","pageY","document","body","addEventListener","mmove","style","top","left","rotate","transform","opacity","mup","Math","abs","likeOrNope","removeEventListener","remove","setTimeout","post","fromUserId","id","toUserId","Number","status","getElementById","nextElementSibling","firstChild","image","cardImage","cardContent","first_name","profession","backgroundColor","color","cardDetail","self_introduction"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\n\nimport axios from \"axios\";\n\nimport ArrowDownwardIcon from \"@material-ui/icons/ArrowDownward\";\nimport InfoIcon from \"@material-ui/icons/Info\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Box from \"@material-ui/core/Box\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Card from \"@material-ui/core/Card\";\nimport CardActionArea from \"@material-ui/core/CardActionArea\";\nimport CardContent from \"@material-ui/core/CardContent\";\nimport CardMedia from \"@material-ui/core/CardMedia\";\n\nimport { useStyles } from \"../../styles\";\n\nimport calcAge from \"../../functions/calcAge\";\nimport createChatRoom from \"../../functions/createChatRoom\";\n\nimport { onBlock, offBlock } from \"../../actions/blockActions\";\n\nconst SwipeableCard = ({ person, className, cardIsEmpty }) => {\n  const classes = useStyles();\n\n  const [selfIntroIsDisplayed, setSelfIntroIsDisplayed] = useState(false);\n\n  const age = person.birth_date ? calcAge(person.birth_date) : \"-\";\n\n  const isBlocked = useSelector((state) => state.isBlocked);\n  const userLogin = useSelector((state) => state.userLogin);\n  const { userInfo } = userLogin;\n\n  const dispatch = useDispatch();\n\n  const config = {\n    headers: {\n      \"content-type\": \"application/json\",\n      Authorization: `Bearer ${userInfo.token}`,\n    },\n  };\n\n  const readMore = () => {\n    if (isBlocked) return;\n\n    if (!selfIntroIsDisplayed) {\n      setSelfIntroIsDisplayed(true);\n      dispatch(onBlock());\n    }\n  };\n\n  const readLess = (e) => {\n    if (isBlocked) return;\n\n    if (selfIntroIsDisplayed) {\n      setSelfIntroIsDisplayed(false);\n      e.stopPropagation();\n    }\n  };\n\n  const [swipedUser, setSwipedUser] = useState();\n  const [nextUser, setNextUser] = useState();\n  const [like, setLike] = useState();\n  const [nope, setNope] = useState();\n\n  var startX;\n  var startY;\n  var moveX;\n  var moveY;\n  var distanceX;\n  var distanceY;\n\n  const mdown = useCallback(\n    (e) => {\n      dispatch(onBlock());\n\n      // Add class \"drag\" to card\n      swipedUser.classList.add(\"drag\");\n\n      // Normalize mouse and touch\n      if (e.type === \"mousedown\") {\n        var event = e;\n      } else {\n        var event = e.changedTouches[0];\n      }\n\n      // Get location where card starts to move\n      startX = event.pageX;\n      startY = event.pageY;\n\n      // Occur when card moves\n      document.body.addEventListener(\"mousemove\", mmove, false);\n      document.body.addEventListener(\"touchmove\", mmove, false);\n    },\n    [dispatch, swipedUser]\n  );\n\n  const mmove = useCallback(\n    (e) => {\n      // Normalize mouse and touch\n      if (e.type === \"mousemove\") {\n        var event = e;\n      } else {\n        var event = e.changedTouches[0];\n      }\n\n      // Move card to where mouse is\n      moveY = event.pageY;\n      moveX = event.pageX;\n\n      distanceX = moveX - startX;\n      distanceY = moveY - startY;\n\n      swipedUser.style.top = distanceY + \"px\";\n      swipedUser.style.left = distanceX + \"px\";\n\n      // Rotate card as distanceX gets longer\n      const rotate = distanceX / 10;\n      swipedUser.style.transform = `rotate(${rotate}deg)`;\n\n      // Display card more clearly as distanceX gets longer\n      if (distanceX >= 0) {\n        like.style.opacity = distanceX / 100;\n      } else {\n        nope.style.opacity = -distanceX / 100;\n      }\n\n      // Occur when mouse or touch is left\n      swipedUser.addEventListener(\"mouseup\", mup, false);\n      document.body.addEventListener(\"mouseleave\", mup, false);\n      swipedUser.addEventListener(\"touchend\", mup, false);\n      document.body.addEventListener(\"touchleave\", mup, false);\n    },\n    [swipedUser, like, nope]\n  );\n\n  const mup = useCallback(async () => {\n    if (Math.abs(distanceX) < 75 && Math.abs(distanceY) < 75) {\n      swipedUser.style.left = 0;\n      swipedUser.style.top = 0;\n      swipedUser.style.transform = \"rotate(0)\";\n      like.style.opacity = 0;\n      nope.style.opacity = 0;\n\n      dispatch(offBlock());\n    } else {\n      // Mark card as \"like\" or \"nope\" based on distance\n      let likeOrNope;\n      if (distanceX >= 75) {\n        swipedUser.style.left = \"150%\";\n        likeOrNope = \"like\";\n      } else if (distanceX <= -75) {\n        swipedUser.style.left = \"-150%\";\n        likeOrNope = \"nope\";\n      } else if (distanceX > 0 && Math.abs(distanceY) >= 75) {\n        swipedUser.style.left = \"150%\";\n        likeOrNope = \"like\";\n      } else if (distanceX < 0 && Math.abs(distanceY) >= 75) {\n        swipedUser.style.left = \"-150%\";\n        likeOrNope = \"nope\";\n      }\n\n      // Delete event listers\n\n      document.body.removeEventListener(\"mousemove\", mmove, false);\n      swipedUser.removeEventListener(\"mouseup\", mup, false);\n      document.body.removeEventListener(\"touchmove\", mmove, false);\n      swipedUser.removeEventListener(\"touchend\", mup, false);\n\n      // Delete class \"drag\"\n      swipedUser.classList.remove(\"drag\");\n\n      // Delete swiped card\n      setTimeout(() => swipedUser.remove(), 200);\n\n      // React by Like or Nope\n      await axios.post(\n        \"/api/reactions/swipe/\",\n        {\n          fromUserId: userInfo.id,\n          toUserId: Number(swipedUser.id),\n          status: likeOrNope === \"like\" ? \"L\" : \"N\",\n        },\n        config\n      );\n\n      // If match, create chat room and register chat room users\n      if (likeOrNope === \"like\") {\n        createChatRoom(userInfo.id, swipedUser.id, config);\n      }\n\n      // If all Cards have been swiped, show Empty component\n      if (nextUser === null) {\n        setTimeout(() => cardIsEmpty(), 200);\n        dispatch(onBlock());\n      } else {\n        setTimeout(() => dispatch(offBlock()), 500);\n      }\n    }\n  }, [dispatch, swipedUser]);\n\n  useEffect(() => {\n    setSwipedUser(document.getElementById(person.id));\n    setNextUser(document.getElementById(person.id).nextElementSibling);\n    setLike(document.getElementById(person.id).firstChild.nextElementSibling);\n    setNope(\n      document.getElementById(person.id).firstChild.nextElementSibling\n        .nextElementSibling\n    );\n  }, []);\n\n  useEffect(() => {\n    if (!swipedUser) return;\n\n    // When self introduction is displayed, not allow user to swipe\n    if (selfIntroIsDisplayed) {\n      document.body.removeEventListener(\"mousemove\", mmove, false);\n      document.body.removeEventListener(\"touchmove\", mmove, false);\n      document.body.removeEventListener(\"mouseleave\", mup, false);\n      document.body.removeEventListener(\"touchleave\", mup, false);\n    }\n\n    // When blocked, delete event\n    if (isBlocked) {\n      swipedUser.removeEventListener(\"mousedown\", mdown, false);\n      swipedUser.removeEventListener(\"touchstart\", mdown, false);\n    }\n\n    // When not blocked and self introduction is not displayed, allow user to swipe\n    if (!isBlocked && !selfIntroIsDisplayed) {\n      swipedUser.addEventListener(\"mousedown\", mdown, false);\n      swipedUser.addEventListener(\"touchstart\", mdown, false);\n    }\n  }, [swipedUser, isBlocked, selfIntroIsDisplayed, mdown, mmove, mdown]);\n\n  return (\n    <Card className={className} id={person.id}>\n      <CardMedia\n        image={person.image ? person.image : \"/images/unknown.png\"}\n        className={classes.cardImage}\n        title=\"profile photo\"\n      />\n      <Typography component=\"span\" variant=\"h3\" className=\"card__like\">\n        LIKE\n      </Typography>\n      <Typography component=\"span\" variant=\"h3\" className=\"card__nope\">\n        NOPE\n      </Typography>\n\n      <CardActionArea onClick={readMore}>\n        <CardContent className={classes.cardContent}>\n          <Typography component=\"h1\" variant=\"h3\" gutterBottom>\n            <strong>{person.first_name}</strong>{\" \"}\n            <Typography component=\"span\" variant=\"h4\">\n              {age}\n            </Typography>\n          </Typography>\n\n          <Grid container alignItems=\"center\">\n            <Grid item xs={6}>\n              {person.profession && (\n                <Typography component=\"h2\" variant=\"h6\" gutterBottom>\n                  <i className=\"fas fa-graduation-cap\"></i> {person.profession}\n                </Typography>\n              )}\n            </Grid>\n\n            <Grid item xs={6}>\n              <Box component=\"div\" textAlign=\"right\">\n                {selfIntroIsDisplayed ? (\n                  <IconButton\n                    style={{\n                      backgroundColor: \"#f50057\",\n                    }}\n                    component=\"span\"\n                    onClick={(e) => readLess(e)}\n                  >\n                    <ArrowDownwardIcon\n                      style={{\n                        color: \"#fff\",\n                      }}\n                      fontSize=\"large\"\n                    />\n                  </IconButton>\n                ) : (\n                  <IconButton component=\"span\">\n                    <InfoIcon fontSize=\"large\" />\n                  </IconButton>\n                )}\n              </Box>\n            </Grid>\n          </Grid>\n\n          {selfIntroIsDisplayed && (\n            <Box mt={1}>\n              <Typography\n                component=\"p\"\n                variant=\"h5\"\n                color=\"textSecondary\"\n                className={classes.cardDetail}\n              >\n                {person.self_introduction}\n              </Typography>\n            </Box>\n          )}\n        </CardContent>\n      </CardActionArea>\n    </Card>\n  );\n};\n\nexport default SwipeableCard;\n"]},"metadata":{},"sourceType":"module"}